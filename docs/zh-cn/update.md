# 更新日志

v1.7.5

## 2015-1-13 21:48:37

1.修复 TPA 系统 BUG，增加 TPA 屏蔽模式. 2.语法上细节优化，增加自动检测 IP 实现自动登录系统.

## **2018.7.18**

修改 PRACE 完成结束为 20 秒，10 秒倒计时提醒。
修复小世界无法说法 BUG
进入赛道自动设置小世界，离开自动退出
修改速度表为玩家计时，非空表转，节约带宽，理论支持 TV 模式下看对方玩家的车速..

（以上可能均有 BUG，等待测试与修复）

## 2018.7.20

优化部分代码逻辑结构
理论支持赛道实时显示对局房间排名
玩家颜色为随机，并非以前固定

（以上可能均有 BUG，等待测试与修复）

## 2018.7.27

修复赛道实时排名异常
修改赛道计时时间为 10ms，更动态显示毫秒
修复赛道第一个点自杀重生回到 0,0,0 坐标问题
修复大部分赛道倒计时问题（还有一点小问题）
修复诸多 BUG

## 2018.7.29

修复 诸多 BUG
修改 新样式速度表

## 2018.7.30

数据库加密！数据库加密！之前版本请千万不要泄露

---

> 中间停更了好久……很多更新日志都没写了 趁着疫情写写完免费开源

## 2020.1.6

**重启 RST 车队官方服务器**并**增加 Linux 服务端**
格式化代码
优化一丁丁的 return 及简化部分代码

## 2020.1.12

修复 由 timerfix 插件引起的计时器随机性概率被杀

1. 修复 玩家下线后未清理干净 infobj
2. 修复 /soundstop 未停止
3. 修复 在重生时离开赛道导致屏幕一直显示“重生中”字样
4. 修复 赛道 CP 点重生后车辆的朝向角度不是 CP 点的朝向角度
5. 修改 速度表红色底色
6. 修改 速度表的时间频率为 100 毫秒
7. 修改 刷车的相关代码
8. 增加 赛车系统时**允许 pm 聊天**
9. 增加 赛车时**离开载具自动复位**
10. **_尝试性修复_** 单人赛道房间浪费资源运算实时排名
11. **_尝试性修复_** TV 玩家时速度表不显示或显示错误
12. **_尝试性增加_** 赛车世界至 1000 个
13. **_尝试性修复_** TV 玩家下车上车响应动态跟踪 TV

> 第一名碰到点后触发的倒计时的 KillTimer 排名可能还存在问题 需要重做倒计时系统

已知问题:

- ~~单人赛道房间也会浪费资源运算实时排名~~
- ~~双人或多人在完成比赛或未完成比赛时触发倒计时的时候的神奇 BUG（不离开小世界，CP 点重样，屏幕字没清理干净，没回到大世界等~~
- 第一名碰到点后触发的倒计时的一系列 BUG
- ~~密码输入错误应该是 3 次机会但是还是有 4 次机会~~
- ~~由于总人数更新，赛车世界需要再增 500 个（共 1000 个)~~
- 在副驾驶进入赛道导致没有车辆
- ~~kgobj 好像没卵用~~

提交 BUG 请在群里反馈

已知意见：

- 刷车效率提升
- 赛道重生增加 C 键或 F 键或下车自动重生
- 增加家具、PHouse 系统
- help 重做
- 增加动作系统

## 2020.1.13

1. 刷车效率提升
2. 赛道中下车自动死亡重生
3. 重做/dcar 和 Repair 的相关判定
4. 尝试密码共 3 次机会
5. TV 中对方切换小世界响应观看者自动进入并观看
6. 想观看的对象正处观看他人时则提醒对方已进入 TV 状态
7. 服务器动态名字

### 已知问题

- ~~默认就是车辆无敌，进入游戏后首次输入 dcar 仍然提示开启车辆无敌（需重做）~~
- 部分用户因刷车效率提升蹦游戏，后期需要调刷车延迟稍微大一点点
- ~~处于编辑状态中的赛道仍可进入~~

#### 赛道计划

- 把有的赛道的数据库迁移进 PRace（难度挺大），正在处理中
- 反作弊二次升级（判断 CP 两点间距离和玩家如果上一秒距离下一个点很远，但下一秒就贴到脸上（没吃到点的那种，则判定作弊）
- ~~打算今后用日期命名 pwn~~
- 把/r s 单页的显示赛道数量调多一点？

#### 已知意见

继承 2020.1.12 的所有

- 增加管理员重置密码选项，当管理员为该用户设置后，且改用户在线上，那么就可以直接重新生成密码，保留其他的数据

## 2020.1.14

正在尝试把 7F 数据库都搬过来哦

已知 BUG

- ~~有可能终点的 CP 点消不掉~~
- CP 点倒是消了，结果**倒计时没了**，还多了个房主离开房间的时候其他玩家的 CP 点没清掉

修复

- 赛道被编辑状态却还能加入的状态
- TV 谁都一直是正在 TV 的状态
- ~~现在完成赛道后也显示多少秒了，不用再去换算啦~~
- 又尝试修复了一遍登录前会显示其他人的赛道状态的问题？？？
- 赛道数据库迁移了所以上限和每页显示的数量提升了
- 然后有时候赛道的时候切出去太久回来车直接没了…… 这个理论上现在修复了

## 2020.1.15

- **导入成功 7F 的赛道数据库，对照所有服来讲为数不少的百条赛车数据库建立 √**
- **增强反作弊，避免红点传送误杀（增加了距离判断**，理论上以后还会更新更强的，也就是每秒判断玩家距离到下一个 CP 点距离且下一个 CP 点的高级函数没有传送就判定作弊）
- ~~作弊被封的时候 KickEx 能够让玩家知道自己被封多久了，不必每次上线再看~~
- ~~被封了还能直接上号~~

已知问题

倒计时 房主进了之后剩下的人直接退赛道

~~tv off 速度表好像还是没清掉 不过已经改了或许修复了~~

赛道倒计时一如既往神奇的 BUG（如果只有自己一个人结果还是会触发倒计时的问题 还有多个人的话就不显示倒计时的问题）

赛道 rid 107~132 的 CP 点出现严重 BUG

~~赛道中重生导致无限死亡~~

~~重生状态下离开不会回到大世界（现在大概已经修复了吧~~

补充：删除赛道的话，要 3 个表都去走，以 rid 为准，DELETE WHERE RID=那个赛道，不然会删不干净

如果部分赛道名字和赛道没对上请联系反馈手动维修

## 2020.1.17

- 理论修复了比赛完成后倒计时的 BUG

想要增加到终点后如果还存在其他玩家则自动观战，增加战局的详细信息统计如玩家的平均速度

然后重生到开比赛的地方？

用 rgamecp 判断玩家是否已经开了比赛 一般在的话就是真 也就是>=1

然后 tv 但是所有自动切换 tv 的地方都得改改咯

showtextdraw cptextdraw time top 还有那个 Race_ShowCp 展示玩家的地图点

## 2020.2.4

- 新增 15 秒增加一次氮气（原先氮气算法）
- 随机出生点及播放音乐
- 系统传送点在大世界将显示 3D 文字
- 尝试修复/r page 页数错误的问题
- 增加动作脚本/anim
- 优化登录界面加载顺序
- 尝试修复速度表丢 km/h 的情况

## 2020.2.5

- 尝试增加观战时显示玩家的 CP 点，时间，排名
- 修改部分样式
- 尝试增加多人房间某玩家完成比赛后自动 TV 剩余的玩家
- 修复 unfinished win finish 显示
- 修复在车上换皮肤导致的显示错误
- 修复 TV 状态下死亡无效以及显示异常
- 修复玩家吃 CP 点的时候观战玩家无提示音
- 尝试修复玩家观战时在没吃点前不显示 CP 点
- 尝试性修复锁了车没效果
- 尝试性增加进入车辆提示是否为本人车辆
- 增加碰碰车/ppc

## 2020.2.6

- 以前的 OBJ 和传送点的 3D 文字改用流光插件函数

- infobj 改为流光的函数

- kgobj 修改

- 加入 hys 车辆自动变色

- 流光渲染 OBJ 渲染距离修改为 500 原来为 300[好像没什么卵用]

- 优化主地图的 for 到 maxplayer 的算法改为 for (_new_ i = GetPlayerPoolSize(); i >= 0; i--) {

  > GetPlayerPoolSize 服务器上当前正在使用的最高玩家编号；如果没有玩家，则返还**0**

下一步打算把 MapIcon 用流光插件做赛车的普通检查点，显示按某个键发起该比赛，然后弹出对话框加入。

## 2020.2.7

- 重做/help 和/sz
- 修复验证时间不更新的问题
- 修改判定锁车后上车的 BUG
- 天气限制为 0~255
- 游戏时长< 120 分钟登录后自动弹出/help
- /time 格式修改为 /time 时 分
- 修改读取数据库的部分结果 和以往版本不能混用
- 尝试修复家具并融合 gamemode
- 修复刷武器时不选武器也会刷的 BUG
- 增加 PHouse 并适配金钱至 RST 用户数据库的 Cash

## 2020.2.8

- 自 2020.2.7 版本起，大部分文件都修改了路径
- 修复了 vmake 未同步修改路径的错误
- 改回 kgobj
- 赛道排名改为 1st,2nd,3rd,4th,5th,6th
- 修复按 Y 呼不出家具
- 尝试修复 PHouseedit 并修改了指令
- 修改了部分公告
- 修复管理员帮助无效
- 修复设置界面的 OBJ 显示反了

已知问题 /sz 的时间一直处于 12 点 GetPlayerTime 函数不知道出了什么鬼问题，代码是绝对没问题的

已知问题 无法绑定邮箱以及找回密码【目前没开 PHP】

## 2020.2.9

- 修复 gogoods 永远 ID0
- 修复自动修车及换颜色会被副驾驶影响
- 修复 giveadmin 和 unadmin 失效的问题
- 尝试修复终点的 CP 点不计算排名的问题
- 尝试修复因 Race_Game_Quit 一处代码导致的倒计时失效的问题
- 修复/sz 设置时间和天气时点取消仍然设置
- 修复点击出生时的 notice 时概率性出现多次 SCM 的情况
- ~~创建 CP 点时将检测玩家将创建的点与上一个点的距离是否过近，如过近则不允许创建~~
- /r /r edit 适配 help 里的 dialog
- 修复因指令过快导致 r edit d 不弹出界面
- 修复按键导致断氮气
- 游戏时间不足 30 分钟，不可创建赛道
- 修复房产没对上号的问题
- 修复玩家掉线后未正确处理 tvid 导致速度表异常
- 修复 CP 点有可能没删干净的问题
- Phouse 的按键 C 改到按键 Y
- 修复刷车后偶然出现没氮气的情况
- 修复刷车导致视角丢失
- 修复完赛后观战，玩家冲线后 CP 点不清

## 2020.2.10

- 修复按 Y 家具失效
- PHouse 总 OBJ 上限调至 10W，总文档上限调至 1000
- 家具修改管理员等级
- TAB 点击玩家现在支持显示管理员等级了
- PHouse stock 函数适配 playerid 提示 ☆
- 取消显示*对方当前未在赛道中，是否继续观看？* 直接退出 tv 再显示结算对话框
- 结算比赛将获得金币，可用于购买房子
- 大世界将显示所有赛道的发起点 即第一个 CP 点
- 修复距离过远显示文字
- 增加了一些单机有的 MapIcon
- 取消原来的 textdraw notice 改为对话框形式
- Houseedit 适配 SCM
- 修复部分房产冲突
- 尝试修复 gogoods id 有问题 delgoods 因原作者语句顺序问题导致 OBJID 显示异常
- 修复 delgoods 不能删除 id0

## 2020.2.11

- 房产在地图上将根据出售和已售自动生成地图图标
- 修复观战时吃 CP 点没声音
- 增加脚本免重启添加 OBJ
- 我的设置的天气增加天气提醒
- 修改个人信息 DIALOG 样式

## 2020.2.14

- 新增车辆翻车后自动翻转设置 已默认开启 /sz 可关闭
- 已知问题 编辑赛道的设置 CP 点以及测试该赛道失效 因 PRace 版本的锅
- 将来将会加入 cveh 高级函数 即在赛道中换车（别忘了 PlayerInfo playerid [Buyid] = 刷出来的车 这样和赛道重生才能匹配上）

- 赛车反作弊即将升级，将有利于判断是否为过于异常数据刷赛道

算法 玩家上一个 CP 点不是高级 CP 点 且 玩家 z 轴和上一次 z 轴相差< 10 或更低的值 ~~且 这一秒车速 > 上一秒车速~~ 且 跟上一秒相比 > 某个界限值 则直接封号 1 小时

原理 高级 CP 点可能会有函数设置车辆速度 所以会误封 所以要判断是否是高级 CP 点触发

如果不是则判断玩家的高度是否改变，正常车辆正常行驶在高度相差不是很大的时候，是无法让速度在短时间内突然变高很多，除非下坠的时候。

所以要求出两次 z 轴绝对值相比是否大于玩家下坠的每秒 z 轴 这个要测过的，然后如果是的话再检测

上一秒的车速减去这一秒的车速 （不用绝对值） 如果相差值在某个界限则可判定

这个可以防微加速和暴力数据

至于只是改了车辆最大值的数据的话

还可以加一句 Getspeed 是否大于某个车速

因为有 z 轴高度差的加持，我相信不会很容易误封

~~还得加一个判断上一秒的玩家 CP 点和这一秒的玩家 CP 点相同 不然如果吃了一个 CP 点的话就会误判~~

不对不对 可以直接判断玩家当前的 CP 数是不是高级 CP 点 如果不是就...同上

判断的语句顺序应该很重要 这样可以减少 db 的访问

第一层是判断玩家是否在赛道中

第二层是 z 轴和速度的判断

第三层是判断 CP 点是否为高级点

不然的话一直访问 db 非常消耗算力

## 2020.2.15

赛道反作弊升级 + 2 判断

部分 include stock 的参数已改为 const 参数

增加问答

增加 7F NPC

修改问答为 5 分钟一次

已知问题 问答显示不全

## 2020.2.18

- 修复问答显示不全
- PRace 新增 cveh 和 weather 函数并适配 gamemode
- 修复玩家未登录时 TAB 访问信息不返回的问题
- 修复 PRace 编辑赛道时从这个点测试和修改 CP 大小没反应的问题
- 重新适配官方正版 mkstr 的 inc
- 新增并修复 mta2 赛道 aroundtheworld - 我想环游整片星空，找到你的星球部分 OBJ 掉线的问题
- 修复对方未登录却仍能观看的 BUG
- 修改问答颜色

## 2020.2.20

- 修复部分已知问题
- 修复被封杀后重新登录不弹出剩余时间的 BUG
- 增强某些作弊的判断机制

## 2020.2.21

- 加入 fakekill~~和 car troll 的检测~~
- 修改部分检测机制
- 现在被封禁后将显示封禁代码

## 2020.2.22

- 创建比赛后如果是房主将提示/r s 开始比赛
- 增加某反作弊功能

## 2020.2.23

- 增加 pizza MTA 经典赛道
- 玩家重生时将先删除车辆再重生，避免 code2 反作弊误封
- 房屋系统将只显示在大世界
- 尝试修复重启服务器导致 NPC 异常
- 创建赛道时间改至 60 时间分才可创建
- 创建赛道改至一次-3000 游戏金币
- 重新修改赛道重生
- 修复玩家观战，某玩家跑完赛道导致关闭 tv 的 BUG
- 现在下车不再直接杀死玩家了，而是提示是否确定重生

## 2020.2.24

- 房子单个人上限买 4 套
- 可通过/house list 查看有哪些房子及情况了
- 修复代码 10 误封

## 2020.2.27

- 修复买房上限因某些原因失效
- 可能修复设置车牌号失效的问题
- 反作弊由 1 小时改至 10 分钟
- 车辆换色适配老玩家习惯的/c color
- 修复 giveadmin 出错的 BUG

## 2020.2.29

- 更改密码处适配散列技术
- 未绑定邮箱也可以修改密码了
- Phouse 增加支持纹理和 Area 了
- 理论上修复想上 NPC 车的一瞬间 NPC 切了地方就会被误封代码 3
- 开始抢救乱码问题 预计 1 天
- 修复修改车牌 Z 轴方向和没氮气问题
- 已有代码已转向 izcmd
- 增加装扮

## 2020.3.1

- 增加大量怀旧问答，问答由 4 分钟改为 2 分钟一问，每下一问将回顾上一问的答案
- 已知~~pm 失效~~ 现在 pm 成发电报了 再编译一次就好了 已经修改了
- 增加几种常见装扮
- 问答将按随机顺序
- 增加屏蔽词
- 即将支持 DM 公告牌

## 2020.3.2

- 可能修复了问答出现 0?的问题

- 增加了广告牌系统

- 冗余了部分屏蔽词，屏蔽词达 2700+

- 设置中增加了我的家具，便于传送和编辑

- 设置中增加了我的装扮帮助

- 修复我的时间失效问题

- 修复家具传送第一行的错误

- 修复广告牌删除后仍能传送和编辑

- 尝试修复某些不知道什么贵原因导致玩家 Salt 后边跟了个日期

- ## 修复赛车中能用指令的 BUG

## 2020.3.3

- 尝试修复广告牌字符过长导致的崩服
- 新增爱车
- 修复赛车中仍能输入指令的 bug
- 修复爱车出售玩家不在线拿不到钱的 BUG
- 修复爱车出售刷屏刷钱的 BUG
- 修复爱车出售逻辑上的问题和拿不到钱的问题
- 即将支持 爱车出售给系统 接近原价的回收

## 2020.3.4

- 理论修复无法买系统车，玩家能买未在出售的车的 BUG
- 理论修复创建爱车的时候没任何提示，没 3D 文字的 BUG

## 2020.3.5

- 尝试修复爱车 3D 文字错乱问题

- 爱车 3D 文字将支持流光插件

- 尝试解决 code 10 数据异常 修改了算法

- 理论上修复了爱车不能保存的问题

- 修复问答消失的问题

## 2020.3.6

- 即将支持上爱车提示是否购买，弹窗 dialog，不购买则扔下车
- 支持 ac 或 cars 命令共用，新增 cars wode,召唤爱车直接讲玩家放进车里.
- 即将支持 倒计时只在某个玩家指定范围内显示
- 即将支持 换号（update insert delete 这样子 UID 终身不变）

## 2020.3.7

- 支持上爱车提示是否购买的对话框
- 新增判断爱车上锁后被 CLEO 劫车将复原
- 修复爱车重生后没有颜色的问题
- 倒计时变更为范围倒计时
- 玩家颜色可在/sz 免费修改了
- 聊天细节优化
- 新用户注册将检测是否为合法名字
- 即将支持更换用户名

## 2020.3.8

支持修改用户名

更换用户名 只要 update 名字就好 uid 永久不变

只要检测名字是否带{}，是否为中文字，是否带屏蔽词,是否有同名的玩家，是否为特殊字符或空白字符。

已知问题: 广告牌可能在未知条件触发下造成按 Y 没任何反应

已知问题 赛车删除赛道后 3D 文字和地图图标还在

## 2020.3.12

PRace 将自动根据赛道名升序显示赛道，创建赛道，删除赛道自动同步重新排序

赛道删除后 3d 文字 图标 地图 CP 点将同步删除

理论修复 ac list 显示不全的问题

## 2020.3.14

团队系统初步框架构造

## 2020.3.15

团队系统基本功能实现

加 V 认证

团队适配反瞬移 get

管理员 get 适配反瞬移

16 年和范冬梅一起写的 camera 适配

## 2020.3.16

增加 DM

## 2020.3.17

管理员的 get 和 goto 将支持载具同步

团队新增 get 和 goto 指令/t get /t goto

尝试修复因为重生导致被反瞬移作弊 11 误封

尝试修复无敌时间中删不干净

增加团队频道#

修复 goto 写反

修复团队频道返回值错误问题

## 2020.3.21

修复装扮沙鹰导致的乱码等问题

移除玩家无敌中状态的 3D 文字

修复部分代码引起的 11 反作弊误封

## 2020.3.23

加入爱车禁止进入比赛和编辑赛道的提示

修复跨团队操作成员的严重 BUG

已知问题 Carspam 反作弊未知抽风 可忽略不修或干脆移除

## 2020.3.24

修复因内存栈问题导致的团队成员失效和服务器崩溃

移除 Carspam

即将进行 字符串长度等全局变量代码适当优化

问答将取消大小写限制

尝试修复无团队下仍显示团队的问题

广告牌将显示名字和 UID

尽量减少碰碰车特殊载具

我的设置新增屏蔽碰撞并自动适配赛道系统和碰碰车系统

家具将支持透过大 OBJ 显示 3D 文字了

家具 3D 文字距离从 20 改为 10

修复 name on off 隐藏显示异常

修复 stunt on off 无提示

## 2020.3.25

家具和公告牌过近时，公告牌为最高优先级，而不再是执行了公告牌的瞬间又去执行家具导致卡在公告牌编辑的状态下。

公告牌的 3D 文字将下移一点

## 2020.3.26

DM 玩家攻击后将显示对方的一系列信息

已知问题 DM 在 linux 环境下无法读取到地图

完成赛道后显示 finished 位置将改变

高级 CP 点反作弊增加函数判断

赛道第一个 CP 高度位置过高时同步了 object loading 提示

## 2020.3.27

未来计划

简单的循环一次延时摄影 ×

赛道支持人物行走并写出新的人物反作弊 √

小世界私人世界完善 √

linux 下 DM 地图问题 BUG 修复 √

DM 增加护甲 √

DM 不读取玩家装扮避免公平性 √

DM 支持 PM √

回答问题写在后面 √

修复结算排名显示文字错误 √

**PS linux 下的路径和文件名不可出现中文等字符！**

已知问题 DM 的 FPS 获取频率问题

懒得搞了反正基本上是对的

## 2020.3.29

修复一严重级 BUG 某些情况下导致重复注册问题

管理员可通过 reset 重置用户密码

速度表增加开关选项

减缓进入游戏时的视角速度

团队邀请功能正式使用

支持：

系统传送点列表 /telemenu

管理员创建系统传送点 smake

修复团队成员跨权操作管理员

## 2020.3.31

进入时的上下黑边有缝隙的问题可能解决了

修复解散团队后仍显示在团队

修复邀请玩家加入团队不显示

修复玩家无法加入团队的问题

尝试修复我的家具无效

增加 - 流动广告牌

NPC 加载延迟 1000 毫秒 1 个避免 linux 上总是加载失败

DM 尝试适配移速反作弊

最好是在 4 月中旬前开源

## 2020.4.1

修复团队列表显示不全的问题

修复装扮显示页数限制 5 页等问题

尝试修复 DM 中最后一个死亡因触发 spawnplayer 导致 fakekill 误封

NPC 将延迟至 3 秒添加一个防止加不进来的问题

DM 加入一个几年前的防自瞄

大世界不允许使用某些武器

DM 加入反刷武器的反作弊

修复乘客在赛道中显示数据异常的问题

## 2020.4.2

优化 CRF 代码结构

加入 timerfix 的 include 和 samp 服务器自身的 BUG 修复 fixes 的 inc

已知问题过快的反复 kill 在 DM 里会误封

## 2020.4.3

赛道挂机时间判断延长至 45 秒

降低 11 误封率

-------未来计划-------

增加延时摄影合并在 camera（第一个镜头和最后一个镜头设置的时间才有效）然后留一个单独的指令

尝试增加世界时间

尝试将 7F 的动作脚本合并

修复 fakekill7 在 DM 下的问题

修复 DM 下移速可能不被检测的问题

未来计划

~~小尾巴（个性签名） 称号~~ 烟花（找开源）~~~DM 懒得弄~~~

- 代码全部转向 i-ZCMD(zcmd 优化版) √
- 可通过 cmd\_之前定义的 CMD 调用 √
- 配合 sscanf2（2020.2.27 更新了本地 plugins 和 inc) 部分代码 √
- 未来计划参照上面的 然后加一个 report.db 玩家反馈的数据都在里面，然后状态模仿 MIUI11 提议 - 立案/不立 - 开发 - 结果 (太懒了不想写)
- 加一个 SAMP 原版自带的大楼电梯脚本 √

增加

- 基础的 DM √
- 增加反锁血 fakekill 可能算吧 √
- 刷夜视仪刷枪的反作弊 这个懒的写了
- 公告牌系统，并且判断是否带敏感词汇（聊天也要加）[Anti Swear](https://forum.sa-mp.com/showthread.php?t=324706) 自动变成\* √ <https://forum.sa-mp.com/showthread.php?t=596260>
- 装扮系统 √
- 团队(帮派)系统 √
- 家具购买菜单，需要拥有大量 OBJID，不然很难实现
- 登录界面显示上一次登录时间，需要更新数据库格式了. √
- ~~当玩家挂机时，玩家镜头随机移动或通过 camera editor 创几个点（论坛有这个脚本）,检测玩家是否挂机在自由者 4 里有~~ 改用 16 年范冬梅帮忙一起写的视角工具 √
- 取消原有机制，未设置邮箱保护将可以更改密码 √，~~更改密码将修改为二次验证，即输入两次将在安全设置内增加更换用户名，也就是换用户名但不能够更换到已经注册的用户名，并验证密码，然后踢下线。 **(还差个更换用户名)**~~ 免重新上线的更换用户名已写成功! √
- 把 SAMP 自带的删除的建筑物的官方脚本里填充的加上 ls_elevator ls_beachside ls_apartments 适配流光 √

## 2020.7.6

> _可能是整个 SAMP 圈子首个支持 windows 和**linux**双系统下**unicode**的正则匹配昵称插件_

**对于本次插件更新是基于 ASAN 插件进行修改,暂不打算开源插件源码.**

比 mk124 前辈的 NPatcher 功能更加强大，可控制更多对于昵称的限制。

例如同名玩家可以同时进入服务器，精准控制可使用哪些范围的昵称。

本次更新服务器将在 linux 下默认正则匹配汉字、【】、丶、英文常见符号、英文、数字、下划线

修正

TextDraw 为 PlayerTextDraw,以规避 samp 的 limits 导致的异常问题

增加

玩家设置中的常用开关项可支持保存了

现在金钱操作时会保存数据库（过去是下线时触发）

网络参数显示

TAB 栏信息优化

已知

之前的注册用户 Salt 后面又出现时间了,正在努力查找引起 BUG 的原因(近期将整改数据库列名).

## 2020.7.7-7.8

我的设置常用开关移植到设置中的个性化设置中

个性化设置中现在加入了玩家名称开关和特效奖励开关

相机系统现在可以直接以相机视角而非通过玩家位置进行定位了

修正

帮助系统和设置系统中对话框有时返回错误的问题

## 2020.7.10

增加

 3D 速度表/c 3d

修复

 个性化设置返回问题

 可能修复 NPC 断氮气问题

 出现丢包但颜色不变的问题

删除

 NPC 出生时的 SetSpawnInfo 可能引起未知的问题?

---

## 2020.7.13

修改

 用户注册的 Salt 范围

 自带 npc 加载间隔(3000ms>>100ms)

修复

 个性化设置返回问题

## 2020.7.14

增加

 赛道发起页增加赛道创建日期

 赛道发起页的时间增加分秒毫秒

 PRace 个人记录系统

 等级系统（经验）测试版

 TAB 栏显示等级 对应名称 和 最近 100 场记录

 登陆超时系统

改进

 PRace 全适配 easydialog

 爱车全适配 easydialog

 Camera 全适配 easydialog

 统一爱车颜色变量名为 Color_ACColor

 修改获取页数为 GetMaxPage 全局可调用

 取消了 Camera_GetMaxPage()

 定义 function 为 forward public

 取消 main 的内容,更改至 gamemodeinit 下

 gamemodeexit 下加强了服务端关闭可能性造成用户没保存的问题

 获取比赛次数采用 count 而不再通过 rows

 升级后将 SCM 提示

 修复适配 easydialog 造成的登录错误重试失效的问题

 重置所有 kickex 为 DelayedKick

## 2020.7.15-17

改进

 DM 全适配 easydialog

 团队全适配 easydialog

 npc 全适配 easydialog

 PHouse 全适配 easydialog

 PHouse 取消重复定义的 GetPages 函数，改为 GetMaxPage

 广告牌全适配 easydialog

 Attire 全适配 easydialog

 PlayerInfo 尽可能适配 easydialog 不确定稳定性

计划：全局 EasyDialog + 数据库注册日期和登录日期改用时间戳

## 2020.7.19

修复

 速度表无法显示其他玩家

 优化速度表显示逻辑结构

增加

 团队成员中显示团队成员在线状态

已知 BUG

/selectnpc 失效 <!--完赛经验显示异常--> 观战显速度表不显示速度 比赛信息不显示（是因为 PlayerText:类型只能给创建给的玩家显示，不能给其他玩家显示，但不应该说去改为 Text:，而是让其他玩家为了显示的时候，把自己的数据修改为对方的，而不是说隐藏自己的再去显示对面的这么个思路）

TextDraw 使用 INVALID_TEXT_DRAW 初始化

如果是数组{*Text:*INVALID_TEXT_DRAW,...}

不是数组*Text:*INVALID_TEXT_DRAW

玩家数组{*PlayerText:*INVALID_TEXT_DRAW,...}

不是数组同理

但是用了这个的话 AMX 体积会很大……

## 2020.7.20

### 正式启动计划 DB 转全局 MYSQLR41 并高度依赖 UID

已尝试适配 Goods_Sys,暂不知是否有问题

优化邮箱验证部分代码和数组大小

修改我的物品 mygoods

优化 AccountCheck 函数效率

即将重写所有 users 部分包括 AccountCheck

已知问题

过去的 salt 根据随机数指定的 ASII 码会生成 sql 特殊字符` 导致注册用户异常或读取数据异常或密码错误

至于之前出现的房子相同的问题可能是因为之前的数据库没开 unique 用户名把……

## 2020.7.21

**彻底废除原有的 user.db 表**

理论上彻底根绝**莫名其妙密码错误**和同**用户名多用户保存错误**的问题

**当本地无数据表但有数据库时，自动生成用户空表**（以后拿开源想架服的必须得有 MYSQL 服务，并重新编译服务器 MYSQL 用户，密码，数据表） 注意安全请自行分配用户和权限，本地和远程权限等。

**重写用户表**，**所有用户密码被重置为 123456**

**用户表已适配 MYSQLR41**

**注册日期，最后一次在线日期修改为 timestamp 格式**

**ongamemodeexit 智能适配保存玩家信息，防止直接关闭（除杀进程之外的崩溃）造成的数据不保存**

**登录超时改为 1 分 30 秒，等未来适配邮箱系统时，将更改为 10 分钟**

**并将同时允许多用户同用户名登录[意味着可以挤号了而不是同名进不来(基于 ASAN - RST 团队修改版)]**

增加信誉分系统(试运行,全自动化处理)

调整玩家经验

---

~~**已知问题:时间戳转格式不准确**~~

~~已知问题 邮箱验证系统可能造成用户出生异常，但可游玩，不建议赛道重生等~~

~~已知问题 **重置密码可能导致无法登录（密码错误）**~~

~~已知问题 广告牌不显示名字~~

~~已知问题 出生异常导致如果狗带会被反作弊误判代码 7~~

## 2020.7.22

修复

 重置密码变量错误导致重置错误的问题

 TAB 栏点击玩家等级显示错误问题

 NPC 断氮气问题

~~已知问题 信誉分可能超过 100（负数算法问题）~~

## 2020.7.23

速度表更新频率 →200ms

修正比赛排名计时器没初始化和赛车房间删除错误初始化问题

优化比赛计时器

- 过去的计时器是每个玩家都单独进行计时，那么一个房间如果 6 个人就相当于 6 个计时器
  - 并且因为是超低的频率 10ms，所以一秒钟的递归/运算就达到了 6 \* 100 次 = 600 次
  - 这一次参照房间排名的计算，为单独的房间开计时器，那么再多人他都是一秒钟递归/运算 100 次

玩家 textdraw 可以在销毁后改为 invaild\_...可能比直接在变量初始的地方赋值会好很多（避免直接体积大小太夸张）

## 2020.7.24

团队适配 MYSQLR41

修改团队成员列表返回逻辑

修改团队列表返回逻辑

TAB 栏中的玩家点击团队支持快速跳转至我的团队

其他人点击该玩家则显示邀请加入

## 2020.7.25

爱车适配 MYSQLR41

## 2020.7.26

PRace 适配 MYSQL41 中

已知问题

PRace 加载赛道只能加载一条

## 2020.7.27

PRace 适配 MYSQL41

广告牌适配 MYSQLR41

装扮适配 MYSQLR41

修复 PRace 加载赛道只能加载一条

重写 tpa

TAB 栏现在可以快速请求 TPA 传送了

> PS:以后开源还是挺要技术活的嘛，不然本地都开不起来哦~ 最起码得懂架 MYSQL 服务
>
> 最好是还会 NodeJS 服务,用 linux 平台,还得学会升级 gcc,软链接标准库等

**尝试修复**

(理论上**修复**了**历史遗留问题**)

 **Linux 下 NPC 不触发 onplayerspawn 问题**

 浏览爱车错误问题

 **爱车**上车错误问题（已上锁、无法召唤等）

 召唤爱车成 NPC 车问题

> 造成原因 pACEdit[playerid]是 CarInfo 的第几个的 i 下标而不是车辆 ID(vehicleid)
>
> 误把 pACEdit[playerid]当 vehid 才会造成问题
>
> CarInfo [ pACEdit[playerid] ] [GotoID] 才是对应的 vid

已知问题

PHouse 适配难度略大，修改思路 →MYSQLR41(√)→ 修改表结构（按照一个文档一个表改为所有文档都在一个表，根据文档 ID 去确定哪个 txt 文档里的文件都对应于哪个文档 ID 也就是 把 drop `%i`改为 delete 文档总表 where 文档 ID = 那个文档 创建表也是改为 insert into 总表 哪个文档 ID... 读取也是 from 总表 where .... and 文档 ID = 最最最烦的就是 PHouse 里面的这几个部分了，还有创建事务部分）

~~Linux 下 NPC 不上车，但在 Windows 下正常(**长期问题**)~~

## 2020.7.30

PHouse 适配难度较大，暂时就处于 sqlite 阶段好了，后续再慢慢适配 R41

PHouse db 变量名改为 pHouseData

引入 NodeJS sampmailjs (慢慢开发邮箱绑定等安全操作)

修复更换密码可以为不受长度限制的 BUG

已知问题

找回密码绑了邮箱的话显示异常并且再点一次就提示不要频繁设置

安全中心验证次数过多连进都进不去

## 2020.7.31

尝试适配 sampemail

增加登录时找回密码

摒弃最初的邮箱系统写法

基本重写

修改 yz 表结构默认值为'0'

已知问题

用户注册后需要重新登录才能正常在 TAB 栏个人信息处显示 UID 和注册日期

这里讲讲 MYSQL 的好处

相较于本地化的 sqlite，**mysql 效率更高**，并且可以用**线程、多线程**跑，**并且可以更好分配权限**, 防止远程操作删库跑路等，而 sqlite 只能在 samp 主线程里,如果慢的话就会服务器未响应般的就跟突然丢包 100%一样，数据不传输了，会对玩家操作进行影响

另外**sqlite 对中文**的支持不好

用 mysql 还有一个好处是,可以多个服务器用同一个数据库,实现**多服数据互通,**有钱的话还可以开多地，然后数据库汇总在一个总服务器上就行（我是这么想的，应该是没啥问题的）。然后**再跑个自动备份**的，就会比较安全了，数据大不了云端再备份，也**方便迁移**的

**nodejs 优点相比 php**

过去的邮箱验证采用 php,并且需要在 php 上调用 MYSQL 接口

现在的 nodejs 采用游戏内变量即可生成验证码

并且 nodejs 部署比 php 简单

不需要装 wampserver(win)或者是 apache(linux)

也不需要在 linux 上很折腾

安装完 nodejs 后也就一句 npm install

撑死去改一下 config.json 里的账户密码

然后重新编译下 sampemail.inc 账号密码和服务端 IP 端口就行

一句 node sampemail.js 就开起来了，并且是秒启动

试过就知道多轻量级了

并且 nodejs 的这个 sampemail 可以支持自定义模板并可替换部分标签

发送不同邮件也都可以指定不同的用户名 主题 网页

---

## 2020.8.1

家具系统 Owner 值改为 UID

是否销售的值改为 0 1

修改家具系统表结构

邮箱设置时检查是否已经被使用

user_goods 改为 utf8 表

user_goods 引擎修改为 innodb

修复用户注册后需要重新登录才能正常在 TAB 栏个人信息处显示 UID 和注册日期

创建比赛 textdraw 信息和修改全都统一到函数中

保护赛道机制 - 90 天前的赛道将只能由管理员删除

尝试适配 PRace TextDraw 观战显示

## 2020.8.2

修复

 同 IP 在线被 T 出服务器不提示信息

 广告牌列表页数不准确问题

 退出赛道时提示错误

 理论上修复创建比赛等提示指令错误问题

 适配更换用户名 - 保存赛道、家具名称

修改

 PRace 的部分写法（同房间内玩家循环），提高效率

 msg, 128 全部改为 msg, sizeof(msg) 规范化

 PRace TextDraw 改回英文

 _Race*Cp_Script_Function*_ > RaceCpScript*func*

保护赛道机制 - 180 天前创建的赛道的记录将只能由管理员清空

**适配 PRace TextDraw**

增加赛道信息/r info 指令

**赛道重生已增加 spawnpos**，支持指定位置重生（仅支持一条，如添加多条 spawnpos 只采用优先级顺序第一条）

数据库

 **PRace 中的作者列改为 UID 并且进行数据迁移工作（之前赛道的作者没注册过的用户自动注册）**

 **重做 PRace 主库，删除并重写原有的排行榜字段。**

 **全部统一至个人记录表，旧排行榜已全部转移。**

 **未创建的 PRace 用户已默认注册账号，但无法登录(密码错误，需联系管理员重置)**

```c
    INSERT INTO users(
    `Name` ,
    `Password` ,
    `Salt` )
    SELECT DISTINCT `rauthor` ,
         'null' ,
         'null'
        FROM `race` WHERE NOT EXISTS(
        SELECT `Name` FROM users WHERE `Name` = `rauthor`
    );
```

更新列值为 UID

```c
  update race set race.rauthor = (select users.id from users where race.rauthor = users.name) where
  exists (SELECT 1 from users where race.rauthor = users.name);
```

赛道的话最好是支持无限扩展人数 那么就得废除原先的 PRace 排行榜写法 √

top 榜通过个人记录表去获取 加个 LIMIT 和 ASC 记录就可以了 √

那么最大的问题就是之前的一些记录只能人工转移了 √

创建没创建过的那些人的账号 √

然后 PRace 的 Name 也得去适配 UID，废弃掉, 然后用~~外键~~啊啥的 √

**对吧 想像一下记录全都由个人记录表接管，查询排行榜和最近比赛的指定条数也很方便，封号了直接删那个人的赛车记录也很简单，不用去抹原来的排行榜那种写法，最大的问题在于数据迁移。**

已知问题

 ~~不显示检查点 CP~~

 ~~玩家切换观战不销毁赛车信息~~

 ~~被观战玩家离开 观战玩家不销毁赛车信息~~

 ~~需要增加比赛倒计时给观战者看~~

 刚观战时不显示玩家的地图 CP 点

 ~~textdraw 信息不更新~~

 ~~无法加入比赛~~

如果有耐心的话倒是可以去做个跑跑卡丁车那样子的动态排名有哪些人和对应的网络状况这样子

结算界面也可以参考

**CP 触发点是能单一删除的 输入删除就行了**

## 2020.8.3

- 需要加一个指令重置玩家邮箱

- 增加 GPS 导航系统（地图定位后开启）

PHouse 适配难度略大，修改思路 →MYSQLR41(√ 进行中)→ 修改表结构（按照一个文档一个表改为所有文档都在一个表，根据文档 ID 去确定哪个 txt 文档里的文件都对应于哪个文档 ID 也就是 把 drop `%i`改为 delete 文档总表 where 文档 ID = 那个文档 创建表也是改为 insert into 总表 哪个文档 ID... 读取也是 from 总表 where .... and 文档 ID = 最最最烦的就是 PHouse 里面的这几个部分了，还有创建事务部分） 这个真的头大……是图啥呢当年写的时候要用 drop 和 create 来代表一个房子呢…… 一个 phouse_main 表和一个 phouse_house 表不就行了？？

## 2020.8.31

SetTimer 和 SetTimerEx 均适配为 Timerfix 的`SetTimer_`和`SetTimerEx_`

(npc.inc 除外)

(部分应该还是没适配的比如 PRace(2020.12.27 补充))

## 2020.12.27

_时间戳转日期_

_原作者 Jochemd <http://forum.sa-mp.com/member.php?u=580> BUG 修复:YuCarl77([R_ST]Hygen)_

_很抱歉给各位带来的影响，此 BUG 经研究调查后发现在 12 月才会出现，经过细密的排查，最终修复了该严重漏洞。_

_轻微 BUG:_

_时间戳为 0 时，日显示为-1 即 1970-1--1 00:00:00_

_根本原因是原作者的写法不行，干脆重写部分代码_

_严重 BUG(漏洞):_

_用户登录时将显示最后一次登录时间，在时间戳转换时于`if(day > MonthTimes[month][IsLeapYear(year)])`处导致下标越界_

_科普:_

_unix 时间戳为格林威治时间 1970 年 01 月 01 日 00 时 00 分 00 秒起至现在的总秒数_
_格林尼治标准时间（旧译格林威治平均时间或格林威治标准时间；英语：GreenwichMeanTime，GMT）_
_指位于英国伦敦郊区的皇家格林尼治天文台的标准时间，因为本初子午线被定义在通过那里的经线。_
_BUG 出现原因_

_原作者的疏忽，之前一直计算错的月份，month 此时已为 12 月。数组下标 0~11 对应 1-12 月，_
_也就是之前一直算的是 1 月为 2 月，12 月为 13 月 超出了下标导致计算直接错误但无报错_

_排查结果:_

_时间戳在 1606780800 即北京时间 2020 年 12 月 1 日 8 时 0 分 0 秒及以后时间戳 100%复现此问题（HourGMT）_
_中国时区与英国时区相差 8 小时，以标准返回时间加了 8 小时候所以是 12 月 1 日 8 时后出现_

_修复时间:_
_2020 年 12 月 26 日 23 时 27 分_

- 修复武器攻击他人扣分错误问题

- 修复信誉分显示 3 行 BUG

- 修复啤酒瓶在大世界可以使用的问题

- 修复登录时没有移动镜头和音乐的场景

## 2021.2.10

- 尝试适配并修复`SetTimer_和SetTimerEx_`问题(npc,prace,gamemode)
- 修复部分潜在的`settimer_和settimerex_` BUG(未被反馈),例如踢掉玩家
- 修复卡 obj loading 问题

## 2021.2.13

- 修复“最近比赛”选项卡经过翻页后，始终只能首页和尾页跳转问题

## 2021.2.14

- 已知 远古 BUG 赛道开赛后房主退出其他玩家计时显示异常
- 已知 远古 BUG 最近比赛翻页其他人上一页下一页翻页的是自己的总页数 数据是对方的没问题
- 尝试修复以上远古 BUG 以及隐藏关联同源未被发现的 BUG

## 2021.2.16

- 修复 2021.2.14 发现的问题
- 完赛后播放任务完成音效
- 标准化 Mode 和 Url 显示
- 见更新日志 2020.8.2 >> 重做 PRace 主库，删除并重写原有的排行榜字段。修改了赛道排名系统的数组下标，动态适配房间人数，但仍建议控制房间人数，否则算力过大。20 人及以内应该吃得住。

## 2021.2.23

增加samp-compat插件，适配0.3.7和0.3dl版本互通

## 2021.2.24

适配安卓移动端SAMP 1.08注册登录对话框无法输入问题（修改PASSWORD样式为INPUT），但登陆后闪退。

增加早期被冻结账号提示

## 2021.9.4

初步构建ldz玩家纪念碑代码

## 2021.9.13

ldz玩家纪念碑随机展示用户和动作基本实现

## 2021.10.2

备份数据库，整理目录结构，数据库由utf8转向gbk顺带修复中文名无法登录，修复后台提示SQL1252问题

## 2021.10.7

修复爱车数据表`TagObject` 没有默认值可能引发`cache_get_value_name_int: value 'NULL' is not a number`的问题

修复家具系统`error #1054 while executing query "UPDATE `user_goods`...... Unknown column 'OWNER' in 'field list'` 

修复赛车`cache_get_value_name_int: value 'xxx' is not a number`

修复赛车`cache_get_value_name: field 'rmiaoshu' not found问题`

修复玩家纪念碑查询数据NULL造成的sql error问题

## ~~下一目标~~或许是有生之年会填的~~目标~~坑

- readme添加服务器描述，部署介绍

- 重写登录界面（界面全部靠一侧并到时候邮箱验证系统弄好了的话就接入找回密码系统[textdraw click]）
- 所有东西全上 MYSQLR41
- 传送系统重做（上 MYSQLR41 根据字段对应值判断是系统或者用户创建的）
- <u>_邮箱验证数据库列和结构优化，去掉~~验证和~~code 列，废弃部分原有的写法 √_</u>
- <u>_家具系统的 Owner 改为 UID,没有这个用户的要不删除要不归属某人要么创建用户 √_</u>
- <u>_删除或修改家具数据库的列，把是否销售 issale 的内容改为值,0 和 1 代表逻辑值，可以节省存储空间 √_</u>
- ~~优化广告牌读取 name 方式为 inner join 用户表 这样子去匹配用户的名字 省下加载广告牌一次查询两次数据库的问题~~ √
- PHouse 和~~PRace 的用户名列改为 UID 列，高度适配~~ √，没有该用户则创建账号或看着办

  - 无限爱车系统，我的爱车菜单改为选择爱车哪一辆再进入下一级的我的爱车操控。

- 写几个 Actor 就跟光遇一样可以在他们面前买衣服、爱车、装扮、家具、回最后一次下线的地方。
  - 下线保存玩家颜色
  - 原版三栋大楼电梯系统考虑汉化
- 适配完所有的用户名列为 UID 后(除 PHouse 基本适配),~~全部再引入外键 uid~~
- _邮箱设置的时候加一个是否有人已经用了的这个提示 然后邮箱列用个 unique 吧 √_

**接入**

- _邮箱系统发送部分改基于用 NodeJS 的论坛上大佬的源码 √_

- _支持 gmail 和自定义邮件（我们就用自定义的 smtp 就好了）√_

 _<https://github.com/bruxo00/SAMPMailJS/wiki> √_

**适配**

 比赛观战信息 playertext 的问题 把 hide 改成 destory show 改 create 然后被观察者哪边要加入 set 到所有观战他的人同步一样的信息（**尝试适配中** √）

**小游戏**

 增加一些娱乐设施 比如钓鱼、摩天轮、踩玻璃、烟花系统等

**比赛结算系统**

 上一把没结算前不能开下一把

**比赛房间系统**

 可以浏览有哪些房间进行加入..

**实时 obj 创建及纹理系统**

 用鹏达之前开过服的 **Fusez's Map Editor (Version 3)**

 <https://forum.sa-mp.com/showthread.php?t=648101>

**仲裁举报系统**

 _参考 B 站小黑屋和 CSGO OW 模式_

 _可以加在 tab 栏点击玩家处_

 _<!--第一次点击弹出几种类型的举报-->（个人信息违规、赛道记录异常等）_

 _投票制（明显符合，不符合，弃权），采取玩家等级和时间分达到一定能力，并且具有一定场数的赛 道次数才可以成为仲裁投票者_

 _然后 48 小时或者 72 小时自动结算，投票哪边人多就跟哪边裁定。_

 _个人信息则弹出对话框，比赛则等接入赛道回放系统后，采用 textdraw 操作点击呼出菜单等。_

 **\*比赛记录有问题的撤销对应赛道排名的比赛记录和个人记录**。\*

 _直接降低玩家的信誉度就行_

**封号记录**

- 改用 mysql 列 uid,时间戳,原因,IP

- 调用的时候就可以用 select ... join users 来看名字了(匹配 UID)

**好友系统**

- 查看玩家在线状态、请求传送等

---

**离线/在线消息系统...**

- 限制玩家在线时长发送

- 同时发送一次消息扣一点钱省的乱来

- 不过通过这个功能倒是可以发**系统公告**等了（**类型**）

- 这样就可以把重要的通知和更新内容发给玩家了

- 分已注册玩家和没有注册的玩家 注册完后也要去获取一遍系统公告列表然后读进来插入数据库

- 并且设置为未读

- 然后还要做**已读未读**？？？……（列名）

**- 回复**……？？？？（发送短信？）咋回复呢 对话框式的那种微信啊啥的做不出来的

**- 可通过设置开启 textdraw 显示与关闭。**
**- 通过设置开关接收玩家消息功能**（系统公告无法关闭）

- 点击消息系统则**按类型显示对话框**
- 以列表形式呈现用户名，uid 和数量。
- 点击对应发送人进入后为列表式对话框，
- 包含标题和时间，进入后可看详细内容。
- 同样需要采用屏蔽特殊字系统。
- 用户可进行**删除**操作。

---

**比赛回放系统**

- 自动清理一个月没登录的玩家录制的 npc 文件
- 需要调用 filemanage 插件等越权操作 scr 目录的东西
- 同时加入 npc 和卸载 npc 需要动态增改服务器 maxnpc 数字限制
- 动态范围控制服务器 npc 人数，当然肯定是以玩家为首，所以要判断玩家总数进行调配 npc 数量并提示能否加载

如果这个做出来了 那就可以进阶，适配 prace，实现赛道录像回放功能。
如果录像回放功能做出来了，那就可以做监管系统了（接入举报系统）

微加速可以调用瞬时速度，反作弊每指定毫秒数进行运算，通过最快提速车辆的极限值加一点点偏差值的判断，进行判定。

> 通过之前的 NPC 不上车(LINUX 平台不触发 OnPlayerSpawn)可知,可以先让 NPC 通过延迟一点毫秒数加入(防止 127.0.0.1 Blocking attack 啥的提示) 然后等个一段时间后一次性全部放上车，然后审核员直接进入观战状态，NPC 只进行一次（不循环，然后自动离开 或者啥反正给个下线机制）
>
> 如果其他审核员也要审核这个案子然后 NPC 又已经在了的话 就直接切换过去审核

---

**回归奖励系统**

- 登录时自动判定距离最后一次在线时间多久，满足条件就送点金币啥的吧

---

**赛道重生**

- 加 spawnpos 会更好一些（重生位置),防止在某些赛道下出现意外 √

---

**邀请和操作团队方面**

- 变量优化
- _<u>tab 界面点击玩家团队 如果有团队则显示团队，没有则邀请加入团队，更方便管理 √</u>_
- 如果有团队且是自己团队的人就加一个操作成员
  并且在操作时每一步都要去验证他是否还在队内，不然会误操作
- （万一对方在你操作中途退队，理论上之前已经写好了）

---

**_传送请求_**

- _<!--优化tpa变量名等--> 直接重写了 √_

- _<!--tab栏加入发送tpa请求,方便玩家在人多的时候找不到ID等--> 写了 √_

**\*PHouse 区域的 textdraw 考虑阉割(不启用)** √\*

---

**NPC 录制系统**

- 玩家可花费指定金币进行录制 NPC，并且暂存 1 个月
- 1 个月后自动清理。
- 然后录制的文件可以给一个对话框控制加入或者 T 出，这样子。
- 下线自动 T 出加入的 NPC
- 并且自动控制服务器 maxnpc 上限值

关于 NPC 的一些东西 可以去看看 FCNPC 的一些插件或者写法和功能 好像基于原版没法实现那么高的操作 比如说玩家重新刷车 赛道重生等 好像就很难去接管了?

<https://github.com/ziggi/FCNPC>